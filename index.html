<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Évaluateur de Condition Physique et de Bien-être</title>
    <style>
        /* Your existing styles */
    </style>
</head>
<body>

    <div class="container">
        <h1>Calculateur de santé</h1>
        <form id="sante-form">
            <label for="sexe">Sexe :</label>
            <select name="sexe" id="sexe" required>
                <option value="homme">Homme</option>
                <option value="femme">Femme</option>
            </select>
            <label for="distance">Distance parcourue en mètres (pendant 12 minutes) :</label>
            <input type="number" name="distance" id="distance" required>
            <input type="submit" value="Calculer">
        </form>

        <!-- New button to calculate distance using GPS -->
        <button id="start-gps" style="margin-top: 20px;">Calculer la distance avec le GPS</button>

        <div id="resultats">
            <h2>Résultats du calcul de santé</h2>
            <p>VO2 max estimé : <span id="vo2max"></span></p>
            <p>SOH : <span id="soh"></span>%</p>
            <p>Années restantes estimées : <span id="annees-restantes"></span></p>
        </div>

        <!-- Your existing description -->
    </div>

    <footer>
        &copy; 2024 Calculateur de Santé. Tous droits réservés. Créé par Mohamed ATRANI.
    </footer>

    <script>
        let startTime;
        let totalDistance = 0;
        let previousPosition = null;
        let tracking = false;

        document.getElementById('sante-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const sexe = document.getElementById('sexe').value;
            const distance = parseFloat(document.getElementById('distance').value);

            let VO2max25_ans, age_fin_de_vie;

            if (sexe === "homme") {
                VO2max25_ans = 44.6;
                age_fin_de_vie = 71;
            } else {
                VO2max25_ans = 35.7;
                age_fin_de_vie = 76;
            }

            const VO2max = (distance - 504.9) / 44.73;
            const SOH = (VO2max / VO2max25_ans) * 100;

            let annees_restantes;
            if (SOH < 50) {
                annees_restantes = 0;
            } else {
                annees_restantes = (SOH - 50) / (100 - 50) * (age_fin_de_vie - 25);
            }

            document.getElementById('vo2max').textContent = VO2max.toFixed(2);
            document.getElementById('soh').textContent = SOH.toFixed(2);
            document.getElementById('annees-restantes').textContent = annees_restantes.toFixed(2);

            document.getElementById('resultats').style.display = 'block';
        });

        document.getElementById('start-gps').addEventListener('click', function() {
            if (!tracking) {
                startTracking();
            } else {
                stopTracking();
            }
        });

        function startTracking() {
            if (navigator.geolocation) {
                startTime = Date.now();
                totalDistance = 0;
                tracking = true;
                document.getElementById('start-gps').textContent = 'Arrêter le suivi GPS';
                
                navigator.geolocation.watchPosition(position => {
                    if (previousPosition) {
                        const dist = calculateDistance(previousPosition, position);
                        totalDistance += dist;
                    }
                    previousPosition = position;

                    if ((Date.now() - startTime) >= 12 * 60 * 1000) {
                        stopTracking();
                    }
                });
            } else {
                alert("La géolocalisation n'est pas supportée par ce navigateur.");
            }
        }

        function stopTracking() {
            tracking = false;
            document.getElementById('distance').value = totalDistance.toFixed(2);
            document.getElementById('start-gps').textContent = 'Calculer la distance avec le GPS';
            alert(`Distance parcourue en 12 minutes : ${totalDistance.toFixed(2)} mètres`);
        }

        function calculateDistance(pos1, pos2) {
            const R = 6371e3; // Earth radius in meters
            const lat1 = pos1.coords.latitude * Math.PI / 180;
            const lat2 = pos2.coords.latitude * Math.PI / 180;
            const deltaLat = (pos2.coords.latitude - pos1.coords.latitude) * Math.PI / 180;
            const deltaLon = (pos2.coords.longitude - pos1.coords.longitude) * Math.PI / 180;

            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +
                      Math.cos(lat1) * Math.cos(lat2) *
                      Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // Distance in meters
        }
    </script>

</body>
</html>
